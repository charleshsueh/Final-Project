"0","# 檢查數據完整性"
"0","cat(""Checking for NA in train_data_selected:\n"")"
"1","Checking for NA in train_data_selected:
"
"0","print(any(is.na(train_data_selected)))"
"1","[1]"
"1"," FALSE"
"1","
"
"0","cat(""Checking for NA in test_data_selected:\n"")"
"1","Checking for NA in test_data_selected:
"
"0","print(any(is.na(test_data_selected)))"
"1","[1]"
"1"," FALSE"
"1","
"
"0","# 提取特徵和標籤"
"0","X_train <- as.matrix(train_data_selected %>% dplyr::select(-eye_detection))"
"0","y_train <- train_data_selected$eye_detection"
"0","X_test <- as.matrix(test_data_selected %>% dplyr::select(-eye_detection))"
"0","y_test <- test_data_selected$eye_detection"
"0",""
"0","# 標準化數據"
"0","means <- colMeans(X_train)"
"0","sds <- apply(X_train, 2, sd)"
"0","sds[sds == 0] <- 1  # 防止除以 0"
"0","X_train <- scale(X_train, center = means, scale = sds)"
"0","X_test <- scale(X_test, center = means, scale = sds)"
"0","# 直接使用 e1071::svm 訓練模型"
"0","set.seed(1754)"
"0","svm_model <- e1071::svm(x = X_train, y = y_train, "
"0","                          kernel = ""radial"", "
"0","                          cost = 1, "
"0","                          gamma = 0.1, "
"0","                          probability = TRUE, "
"0","                          class.weights = c(""0"" = 1, ""1"" = 1))"
"0",""
"0","# 打印模型摘要"
"0","print(summary(svm_model))"
"1","
Call:"
"1","
"
"1","svm.default(x = X_train, y = y_train, kernel = ""radial"", gamma = 0.1, cost = 1, class.weights = c(`0` = 1, `1` = 1), "
"1","
"
"1","    probability = TRUE)"
"1","
"
"1","
"
"1","
"
"1","Parameters:
"
"1","   SVM-Type: "
"1"," "
"1","C-classification"
"1"," "
"1","
"
"1"," SVM-Kernel: "
"1"," "
"1","radial"
"1"," "
"1","
"
"1","       cost: "
"1"," "
"1","1"
"1"," "
"1","
"
"1","
Number of Support Vectors: "
"1"," "
"1","608"
"1","

"
"1"," ("
"1"," "
"1","332"
"1"," "
"1","276"
"1"," "
"1",")

"
"1","
Number of Classes: "
"1"," "
"1","2"
"1"," "
"1","

"
"1","Levels:"
"1"," "
"1","
"
"1"," "
"1","0"
"1"," "
"1","1"
"1","

"
"1","

"
"0","# 預測訓練集和測試集"
"0","train_predictions_svm <- predict(svm_model, newdata = X_train)"
"0","train_accuracy_svm <- mean(train_predictions_svm == y_train)"
"0","cat(""SVM Training Accuracy:"", train_accuracy_svm, ""\n"")"
"1","SVM Training Accuracy:"
"1"," "
"1","0.9889706"
"1"," "
"1","
"
"0","test_predictions_svm <- predict(svm_model, newdata = X_test)"
"0","test_accuracy_svm <- mean(test_predictions_svm == y_test)"
"0","cat(""SVM Test Accuracy:"", test_accuracy_svm, ""\n"")"
"1","SVM Test Accuracy:"
"1"," "
"1","0.9460784"
"1"," "
"1","
"
"0","# 添加混淆矩陣"
"0","confusion_matrix_svm <- confusionMatrix(test_predictions_svm, y_test)"
"0","print(confusion_matrix_svm)"
"1","Confusion Matrix and Statistics

"
"1","          Reference
"
"1","Prediction"
"1","   0"
"1","   1"
"1","
         0"
"1"," 100"
"1","   9"
"1","
         1"
"1","   2"
"1","  93"
"1","
"
"1",""
"1","                         "
"1","                 "
"1","
"
"1","               Accuracy :"
"1"," 0.9461          "
"1","
"
"1","                 95% CI :"
"1"," (0.9056, 0.9728)"
"1","
"
"1","    No Information Rate :"
"1"," 0.5             "
"1","
"
"1","    P-Value [Acc > NIR] :"
"1"," < 2e-16         "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","                  Kappa :"
"1"," 0.8922          "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1"," Mcnemar's Test P-Value :"
"1"," 0.07044         "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","            Sensitivity :"
"1"," 0.9804          "
"1","
"
"1","            Specificity :"
"1"," 0.9118          "
"1","
"
"1","         Pos Pred Value :"
"1"," 0.9174          "
"1","
"
"1","         Neg Pred Value :"
"1"," 0.9789          "
"1","
"
"1","             Prevalence :"
"1"," 0.5000          "
"1","
"
"1","         Detection Rate :"
"1"," 0.4902          "
"1","
"
"1","   Detection Prevalence :"
"1"," 0.5343          "
"1","
"
"1","      Balanced Accuracy :"
"1"," 0.9461          "
"1","
"
"1","                         "
"1","                 "
"1","
"
"1","       'Positive' Class :"
"1"," 0               "
"1","
"
"1","                         "
"1","                 "
"1","
"
"0","# ROC 和 AUC"
"0","# 獲取概率預測"
"0","test_prob_svm <- predict(svm_model, newdata = X_test, probability = TRUE)"
"0","cat(""SVM Probability Output (Full Structure):\n"")"
"1","SVM Probability Output (Full Structure):
"
"0","str(test_prob_svm)"
"1"," Factor w/ 2 levels ""0"",""1"": "
"1",""
"1","1 1 1 1 1 1 1 1 1 1"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","- attr(*, ""names"")="
"1"," chr [1:204] "
"1",""
"1","""4"" ""6"" ""7"" ""9"""
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","- attr(*, ""probabilities"")="
"1"," num [1:204, 1:2] "
"1",""
"1","0.642 0.925 0.989 0.93 0.995"
"1",""
"1"," ..."
"1",""
"1","
"
"1","  .."
"1",""
"1","- attr(*, ""dimnames"")="
"1","List"
"1",""
"1"," of "
"1",""
"1","2"
"1",""
"1","
"
"1","  .. .."
"1",""
"1","$ "
"1",""
"1",""
"1",""
"1",":"
"1"," chr [1:204] "
"1",""
"1","""4"" ""6"" ""7"" ""9"""
"1",""
"1"," ..."
"1",""
"1","
"
"1","  .. .."
"1",""
"1","$ "
"1",""
"1",""
"1",""
"1",":"
"1"," chr [1:2] "
"1",""
"1","""0"" ""1"""
"1",""
"1","
"
"0","# 提取概率值"
"0","test_prob_svm <- attr(test_prob_svm, ""probabilities"")"
"0","cat(""SVM Probabilities (First 5 Rows):\n"")"
"1","SVM Probabilities (First 5 Rows):
"
"0","print(head(test_prob_svm))"
"1","  "
"1","         0"
"1","           1"
"1","
4 "
"1"," 0.6421718"
"1"," 0.357828200"
"1","
6 "
"1"," 0.9251914"
"1"," 0.074808606"
"1","
7 "
"1"," 0.9891690"
"1"," 0.010830956"
"1","
9 "
"1"," 0.9301005"
"1"," 0.069899468"
"1","
15"
"1"," 0.9948751"
"1"," 0.005124872"
"1","
18"
"1"," 0.9962818"
"1"," 0.003718197"
"1","
"
"0","# 確認類別順序"
"0","cat(""Levels of y_test:"", levels(y_test), ""\n"")"
"1","Levels of y_test:"
"1"," "
"1","0"
"1"," "
"1","1"
"1"," "
"1","
"
"0","cat(""Column names of test_prob_svm:"", colnames(test_prob_svm), ""\n"")"
"1","Column names of test_prob_svm:"
"1"," "
"1","0"
"1"," "
"1","1"
"1"," "
"1","
"
"0","# 提取類別 1 的概率"
"0","if (""1"" %in% colnames(test_prob_svm)) {"
"0","    svm_probs <- test_prob_svm[, ""1""]"
"0","    cat(""Structure of svm_probs:\n"")"
"0","    str(svm_probs)"
"0","    if (any(is.na(svm_probs))) {"
"0","      stop(""SVM probabilities contain NA values."")"
"0","    }"
"0","  } else {"
"0","    stop(""Class '1' probability not found in SVM predictions."")"
"0","  }"
"1","Structure of svm_probs:
"
"1"," Named num [1:204] "
"1",""
"1","0.35783 0.07481 0.01083 0.0699 0.00512"
"1",""
"1"," ..."
"1",""
"1","
"
"1"," "
"1",""
"1","- attr(*, ""names"")="
"1"," chr [1:204] "
"1",""
"1","""4"" ""6"" ""7"" ""9"""
"1",""
"1"," ..."
"1",""
"1","
"
"0","# 確保 response 是二元數值（0 和 1）"
"0","response_svm <- as.numeric(y_test) - 1"
"0","cat(""Structure of response_svm:\n"")"
"1","Structure of response_svm:
"
"0","str(response_svm)"
"1"," num [1:204] "
"1",""
"1","0 0 0 0 0 0 0 0 0 0"
"1",""
"1"," ..."
"1",""
"1","
"
"0","# 計算 ROC 和 AUC"
"0","roc_svm <- roc(response_svm, svm_probs)"
"0","auc_svm <- auc(roc_svm)"
"0","cat(""SVM AUC:"", auc_svm, ""\n"")"
"1","SVM AUC:"
"1"," "
"1","0.9815456"
"1"," "
"1","
"
